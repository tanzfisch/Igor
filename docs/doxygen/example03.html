<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=9"/>
		<meta name="generator" content="Doxygen 1.8.8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title>Igor: 2D Rendering Example</title>
		<link href="tabs.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript" src="dynsections.js"></script>
		<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
		<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
		<link href="doxygen.css" rel="stylesheet" type="text/css" />
		<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom_dark_theme.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr>
						<td id="projectlogo">                        
                            <div style="position: relative; height: 120px; width: 440px;">
                                <div style="position: absolute; float: right; right: 30px; bottom: 10px; z-index: 1000; background-color: transparent;">0.20.0</div>
                                <img alt="Logo" src="logo.png"></img>                            
                            </div>
                        </td>                            
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part --><!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('example03.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">2D Rendering Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The 2D example shows how to load textures, use the draw callback and draw some simple 2D primitives on the screen. Keep in mind that <a class="el" href="namespace_igor.html">Igor</a> is primarily a 3D engine so there is really not much more to 2D than in this example (<a href="https://www.youtube.com/watch?v=N5gWTnX0B6c">youtube</a>).</p>
<h1>Build </h1>
<p>The code for this example can be found in the folder examples/03 2D. In a vs[ver] sub folder you will find a visual studio solution which contains example project but also all dependent projects. So you just open this one and than build and start. If everything went right you gonna see the following screen. If not please don't hesitate to contact <a href="https://github.com/tanzfisch">tanzfisch</a>.</p>
<div class="image">
<img src="Example03_Pic1.png" alt="Example03_Pic1.png"/>
<div class="caption">
2D Rendering Example</div></div>
<p> If you like to see it moving. Here a link to a short you tube clip <a href="https://www.youtube.com/watch?v=N5gWTnX0B6c">2D Example</a>.</p>
<h1>Code </h1>
<p>Let's directly jump to the init() method. When it comes to rendering we need to set up our window with a view to render to. </p><pre class="fragment">// define a view
// switch of the clear color step because we will use a tiled background so there is no need to clear the framebuffer every frame
_view.setClearColor(false);
// set up an orthogonal projection with the dimensions of the windows client rectangle
// the client rectangle is the size of the actual rendering area
_view.setOrthogonal(0, _window.getClientWidth(), _window.getClientHeight(), 0);
// register callback to the rendering event of this view
_view.registerRenderDelegate(RenderDelegate(this, &amp;Example2D::onRender));
// add the view to the window
_window.addView(&amp;_view);
</pre><p>And because we want to render 2D we setup the view using setOrthogonal using the same resolution as the window client rectangle has. What we want to render happens all in the onRender callback we register here to the view and implement later in this exmaple.</p>
<p>Let's skip the window opening - you should know that by now from the examples before - and go to the first call of the iTextureResourceFactory. This factory is where we get our texture from. To just load a texture we call loadFile like this. </p><pre class="fragment">// load the background tile texture
_backgroundTexture = iTextureResourceFactory::getInstance().loadFile("WidgetThemePattern.png");
</pre><p>It will load the texture synchronously and return after doing so with a shared pointer. The path to the texture by the way is relative to a set of search paths we can define via the iResourceManager. In the next lines we try to load a texture that does not exist to see what happens. </p><pre class="fragment">// let's see what happens if we want Igor to load a texture that does not exist
con_endl("!!! next statement will fail with an error message about a missing texture !!!");
con_endl("");
_dummyTexture = iTextureResourceFactory::getInstance().loadFile("doesnotexist.foobar");
// by default Igor generates a dummy texture that will be returned instead
// it is a checker texture with some gradients in color and alpha channels
</pre><p><a class="el" href="namespace_igor.html">Igor</a> will print an error message to the console and use a generated texture from memory instead. As you have noticed it's the checker texture on the left of the screen shot.</p>
<p>Next we gonna configure a particle system that also uses a texture. But this time we gonna load it asynchronously using requestFile. It will return immediately and all it does is basically putting that load request in to a queue that will be processed later in our example. </p><pre class="fragment">// set up particle system
// load a texture for our particle system
_particleTexture = iTextureResourceFactory::getInstance().requestFile("simpleParticle.png");
</pre><p>Let's continue with the particle system. </p><pre class="fragment">// set the range of particle sizes at spawn
_particleSystem.setParticleSize(10.0f, 70.0f);
// set how much the particles should grow each frame
_particleSystem.setParticleSizeDelta(0.5f, 3.0f);
// set initial velocity vector of particles at spawn
_particleSystem.setInitialVelocity(iaVector2f(40, 0));
// make the animation endless. this causes the particles to be reused after their lifetime is over
_particleSystem.setLoopable(true);
// sets particle life time in frames
_particleSystem.setParticleLifetime(80);
// set the emission rate per frame
_particleSystem.setEmitRate(5);
// set maximal particle count. since the particle system is in loop mode we need at least as 
// much particles as the life time times the emission rate to have a constant stream of particles
_particleSystem.setMaxParticleCount(_particleSystem.getParticleLifetime() * _particleSystem.getEmitRate());
// set the spread factor to 5% of the distribution circle
// you can also interpret it as opening angle in percent
_particleSystem.setSpreadFactor(0.05f);
// don't want air drag
_particleSystem.setAirDrag(0.0f);
// apply external force. in this case something like gravity but positive because the y coordinate axis goes down the screen
_particleSystem.setExternalForce(iaVector2f(0, 0.2f));
</pre><p>For a nice look of the particles we set up a color gradient using the iRainbow class to define the actual rainbow colors. </p><pre class="fragment">// define a rainbow multi color gradient for our particles
_rainbow.insertColor(iaColor4f(1, 0, 1, 0.0), 0.0f);
_rainbow.insertColor(iaColor4f(0, 0, 1, 0.2), 0.2f);
_rainbow.insertColor(iaColor4f(0, 1, 1, 0.4), 0.4f);
_rainbow.insertColor(iaColor4f(0, 1, 0, 0.6), 0.6f);
_rainbow.insertColor(iaColor4f(1, 1, 0, 0.8), 0.8f);
_rainbow.insertColor(iaColor4f(1, 0, 0, 1.0), 1.0f);
</pre><p>So now the particle system is set up (we gonna have a look at how it's rendered later) there is two more ways of using a texture with <a class="el" href="namespace_igor.html">Igor</a>. One is in form of a texture based font and one is a sprite. </p><pre class="fragment">// load a texture font
_font = new iTextureFont("StandardFont.png");

// load a texture as a sprite
// sprites are basically textures that have some additional meta data that help you to place and orientate them
_logo = new iSprite(iTextureResourceFactory::getInstance().loadFile("OpenGL-Logo.jpg"));
// set the center as the origin of the sprite
_logo-&gt;setOrigin(iaVector2f(_logo-&gt;getTexture()-&gt;getWidth() * 0.5, _logo-&gt;getTexture()-&gt;getHeight() * 0.5));
</pre><p>The font implicitly loads a texture synchronously so it can analyse the texture for where the single letters are in order to later nicely print them on screen. The Sprite is basically a texture plus some meta information including the origin (e.g. to rotate around) and with and height in screen space independent of the textures resolution.</p>
<p>An other feature I'd like to introduce is the iaBSpline class. Well it defines a B-Spline that we can use to look up 3D values along the spline. </p><pre class="fragment">// initalize a spline loop
_spline.addSupportPoint(iaVector3f(100, 100, 0));
_spline.addSupportPoint(iaVector3f(150, 80, 0));
_spline.addSupportPoint(iaVector3f(900, 600, 0));
_spline.addSupportPoint(iaVector3f(700, 500, 0));
_spline.addSupportPoint(iaVector3f(100, 700, 0));
_spline.addSupportPoint(iaVector3f(900, 300, 0));
_spline.addSupportPoint(iaVector3f(50, 150, 0));
// close the loop by having the end point at the same position as the start point
_spline.addSupportPoint(iaVector3f(100, 100, 0));
// defines the resolution of the output line strip if we later call getSpline
_spline.setResolution(20);
</pre><p>For rendering anything in <a class="el" href="namespace_igor.html">Igor</a> we need to set up a couple of materials. Basically a material is a set of OpenGL based render states and or some shaders. Right now most of <a class="el" href="namespace_igor.html">Igor</a> still uses old school fix function pipeline due to laziness of the programmer ;-) but given enough time this will change. </p><pre class="fragment">// create some materials
_materialWithTextureAndBlending = iMaterialResourceFactory::getInstance().createMaterial();
iMaterialResourceFactory::getInstance().getMaterial(_materialWithTextureAndBlending)-&gt;getRenderStateSet().setRenderState(iRenderState::Texture2D0, iRenderStateValue::On);
iMaterialResourceFactory::getInstance().getMaterial(_materialWithTextureAndBlending)-&gt;getRenderStateSet().setRenderState(iRenderState::Blend, iRenderStateValue::On);
iMaterialResourceFactory::getInstance().getMaterial(_materialWithTextureAndBlending)-&gt;getRenderStateSet().setRenderState(iRenderState::DepthTest, iRenderStateValue::Off);

_materialWithTexture = iMaterialResourceFactory::getInstance().createMaterial();
iMaterialResourceFactory::getInstance().getMaterial(_materialWithTexture)-&gt;getRenderStateSet().setRenderState(iRenderState::Texture2D0, iRenderStateValue::On);
iMaterialResourceFactory::getInstance().getMaterial(_materialWithTexture)-&gt;getRenderStateSet().setRenderState(iRenderState::DepthTest, iRenderStateValue::Off);

_materialWithoutDepthTest = iMaterialResourceFactory::getInstance().createMaterial();
iMaterialResourceFactory::getInstance().getMaterial(_materialWithoutDepthTest)-&gt;getRenderStateSet().setRenderState(iRenderState::DepthTest, iRenderStateValue::Off);
</pre><p>No it's time to load the requested textures by doing a flush in the iTextureResourceFactory. So technically this is not asynchronous loading of textures. And that is correct but this way you can choose whether to just make a flush between level loading or run it in a separate thread to continuously loading/unloading textures in the background. The last scenario is easiest by just creating iTaskFlushTextures and add it in to the iTaskManager. </p><pre class="fragment">// load requested textures
iTextureResourceFactory::getInstance().flush();
</pre><p>On the deinit end we destroy the created materials ... </p><pre class="fragment">// release materials (optional)
iMaterialResourceFactory::getInstance().destroyMaterial(_materialWithTextureAndBlending);
_materialWithTextureAndBlending = 0;
iMaterialResourceFactory::getInstance().destroyMaterial(_materialWithTexture);
_materialWithTexture = 0;
iMaterialResourceFactory::getInstance().destroyMaterial(_materialWithoutDepthTest);
_materialWithoutDepthTest = 0;
</pre><p>... and destroy the font and the sprite and release the textures. </p><pre class="fragment">// release some textures. otherwhise you will get a reminder of possible mem leak
if (_logo != nullptr)
{
    delete _logo;
    _logo = nullptr;
}

if (_font != nullptr)
{
    delete _font;
    _font = nullptr;
}

_particleTexture = nullptr;
_backgroundTexture = nullptr;
_dummyTexture = nullptr;
</pre><p>Next interessting part in the example is the onHandle implementation which is called before every render frame. And inside of that the updateParticles method. Basically we manipulate the start velocity of the particles over time based on a 2D perlin noise function and than we call the particle systems handle which updates the particles position. </p><pre class="fragment">// manipulates particles initial velocity over time
iaVector2f velocity(12, 0);
float32 emitangle = _perlinNoise.getValue(_particleAnimatioValue * 0.05, 3) + 0.1;

velocity.rotateXY(emitangle);
_particleSystem.setInitialVelocity(velocity);
_particleAnimatioValue += 1.0f;

// calls particles iteration
_particleSystem.handle();
</pre><p>And now we have a look at the rendering which happens in the onRender method. Since <a class="el" href="namespace_igor.html">Igor</a> is based on OpenGL we have to setup the OpenGL matrices first in order to see anything we are going to render. </p><pre class="fragment">// since the model matrix is by default an identity matrix which would cause all our 2d rendering end up at depth zero
// and the near clipping plane of our frustum can't be zero we have to push the scene a bit away from zero (e.g. -30 just a random number with no meaning)
iaMatrixf matrix;
iRenderer::getInstance().setViewMatrix(matrix);
matrix.translate(iaVector3f(0, 0, -30));
iRenderer::getInstance().setModelMatrix(matrix);
</pre><p>Now that the matrices are set up we can besically just switch between materials and colors and directly use all the 2d rendering methods the iRenderer provides. So for rendering our tiled background texture we call ... </p><pre class="fragment">// set a textured material and draw the tiles texture as background
iMaterialResourceFactory::getInstance().setMaterial(_materialWithTexture);
iRenderer::getInstance().setColor(iaColor4f(1, 1, 1, 1));
iRenderer::getInstance().drawTextureTiled(0, 0, _window.getClientWidth(), _window.getClientHeight(), _backgroundTexture);
</pre><p>... and to draw some non textured primitives we call ... </p><pre class="fragment">// set non textured material and draw some primitves
iMaterialResourceFactory::getInstance().setMaterial(_materialWithoutDepthTest);
iRenderer::getInstance().setColor(iaColor4f(0, 0, 0, 1));

iRenderer::getInstance().drawRectangle(10, 10, 200, 150);
iRenderer::getInstance().drawRectangle(220, 10, 200, 150);

iRenderer::getInstance().setColor(iaColor4f(1, 1, 0, 1));
iRenderer::getInstance().setLineWidth(3);

iRenderer::getInstance().drawLine(20, 20, 200, 150);
iRenderer::getInstance().drawLine(20, 150, 200, 20);
iRenderer::getInstance().drawLine(110, 20, 110, 150);
iRenderer::getInstance().drawLine(20, 85, 200, 85);

for (int x = 0; x &lt; 19; ++x)
{
    for (int y = 0; y &lt; 14; ++y)
    {
        iRenderer::getInstance().setPointSize(rand() % 5 + 1);
        iRenderer::getInstance().drawPoint(230 + x * 10, 20 + y * 10);
    }
}
</pre><p>... and this is how we draw a sprite ... </p><pre class="fragment">// change material again to textured an draw the logo
iMaterialResourceFactory::getInstance().setMaterial(_materialWithTextureAndBlending);
iRenderer::getInstance().setColor(iaColor4f(1, 1, 1, 1));
iRenderer::getInstance().drawSprite(_logo, _logoPosition._x, _logoPosition._y, _logoRotationAngle, 1.5f, 1.5f);
</pre><p>... and a regular texture ... </p><pre class="fragment">// draw the texture that we could not load at startup
iRenderer::getInstance().setColor(iaColor4f(1, 1, 1, 1));
iRenderer::getInstance().drawTexture(10, 170, 410, 150, _dummyTexture);
</pre><p>... and the particle system (please notice the rainbow at the end)... </p><pre class="fragment">// draw the particles
iRenderer::getInstance().setColor(iaColor4f(0, 1, 0, 0.5));
iRenderer::getInstance().bindTexture(_particleTexture, 0);
iRenderer::getInstance().drawParticles(-10, _window.getClientHeight() - 150, 0, _particleSystem.getParticles(), _particleSystem.getParticleCount(), &amp;_rainbow);
</pre><p>.. draw some text from wikipedia about OpenGL ... </p><pre class="fragment">// draw some text from wikipedia
iaString wikipediaOpenGL = "OpenGL (Open Graphics Library) ist eine Spezifikation fuer eine plattform- und programmiersprachenunabhaengige Programmierschnittstelle zur Entwicklung von 2D- und 3D-Computergrafik. Der OpenGL-Standard beschreibt etwa 250 Befehle, die die Darstellung komplexer 3D-Szenen in Echtzeit erlauben. Zudem koennen andere Organisationen (zumeist Hersteller von Grafikkarten) proprietaere Erweiterungen definieren. Wikipedia";
iRenderer::getInstance().setFont(_font);
iRenderer::getInstance().setFontSize(15.0f);
iRenderer::getInstance().setColor(iaColor4f(0, 0, 0, 1));
iRenderer::getInstance().drawString(600, 100, wikipediaOpenGL, -30, 400);
</pre><p>... and render the spline ... </p><pre class="fragment">// draw spline
iMaterialResourceFactory::getInstance().setMaterial(_materialWithoutDepthTest);
iRenderer::getInstance().setColor(iaColor4f(1, 0, 0.5, 1));
iRenderer::getInstance().drawLineStrip(_spline.getSpline());
</pre><p>.. and some perlin nioise based 2D graph. </p><pre class="fragment">// draw random graph in the upper right corner
iRenderer::getInstance().setColor(iaColor4f(0, 0, 0, 1));
iRenderer::getInstance().drawRectangle(_window.getClientWidth() - 260, 10, 250, 150);

static float32 offset = 0.0f;
iRenderer::getInstance().setLineWidth(1);
iRenderer::getInstance().setColor(iaColor4f(0, 1, 0, 1));

float64 lastValue = _perlinNoise.getValue(offset * 0.01, 6) * 150;
for (int x = 1; x &lt; 250; ++x)
{
    float64 value = _perlinNoise.getValue((offset + x) * 0.01, 6) * 150;
    iRenderer::getInstance().drawLine(_window.getClientWidth() - 260 + x - 1, 10 + lastValue, _window.getClientWidth() - 260 + x, 10 + value);
    lastValue = value;
}

offset += 1.0f;
</pre><p>Last but not least there is a class alled iStatistics in <a class="el" href="namespace_igor.html">Igor</a> that can measure for you all about timings. We just use it here to draw the frame rate on the screen. </p><pre class="fragment">// draw frame rate in lower right corner
iStatistics::getInstance().drawStatistics(&amp;_window, _font, iaColor4f(0, 1, 0, 1));
</pre><p>And that's all to it. For further questions please contact <a href="https://github.com/tanzfisch">tanzfisch</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
		<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
			<ul>
				<li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>
				<li class="footer">
					Generated on Sat May 25 2019 16:08:36 for Igor by <a href="http://www.doxygen.org/index.html">
					<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8.
					Dark theme by <a href="http://majerle.eu" target="_new">Tilen Majerle</a>. All rights reserved.
				</li>
			</ul>
		</div>
		<script src="custom.js"></script>
	</body>
</html>