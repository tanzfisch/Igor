<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=9"/>
		<meta name="generator" content="Doxygen 1.8.8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title>Igor: Example03_2D_Rendering.md Source File</title>
		<link href="tabs.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript" src="dynsections.js"></script>
		<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
		<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
		<link href="doxygen.css" rel="stylesheet" type="text/css" />
		<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom_dark_theme.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr>
						<td id="projectlogo">                        
                            <div style="position: relative; height: 120px; width: 440px;">
                                <div style="position: absolute; float: right; right: 30px; bottom: 10px; z-index: 1000; background-color: transparent;">0.20.0</div>
                                <img alt="Logo" src="logo.png"></img>                            
                            </div>
                        </td>                            
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part --><!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_example03__2_d___rendering_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Example03_2D_Rendering.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_example03__2_d___rendering_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;2D Rendering Example                                    {#example03}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;====================</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;The 2D example shows how to load textures, use the draw callback and draw some simple 2D primitives on the screen. Keep in mind that Igor is primarily a 3D engine so there is really not much more to 2D than in this example ([youtube](https://www.youtube.com/watch?v=N5gWTnX0B6c)).</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;Build</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;=====</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;The code for this example can be found in the folder examples/03 2D. In a vs[ver] sub folder you will find a visual studio solution which contains example project but also all dependent projects. So you just open this one and than build and start. If everything went right you gonna see the following screen. If not please don&#39;t hesitate to contact [tanzfisch](https://github.com/tanzfisch).</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;![2D Rendering Example](/images/Example03_Pic1.png)</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;If you like to see it moving. Here a link to a short you tube clip [2D Example](https://www.youtube.com/watch?v=N5gWTnX0B6c).</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;Code</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;====</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;Let&#39;s directly jump to the init() method. When it comes to rendering we need to set up our window with a view to render to.</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    // define a view</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    // switch of the clear color step because we will use a tiled background so there is no need to clear the framebuffer every frame</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    _view.setClearColor(false);</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    // set up an orthogonal projection with the dimensions of the windows client rectangle</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    // the client rectangle is the size of the actual rendering area</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    _view.setOrthogonal(0, _window.getClientWidth(), _window.getClientHeight(), 0);</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    // register callback to the rendering event of this view</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    _view.registerRenderDelegate(RenderDelegate(this, &amp;Example2D::onRender));</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    // add the view to the window</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    _window.addView(&amp;_view);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;And because we want to render 2D we setup the view using setOrthogonal using the same resolution as the window client rectangle has. What we want to render happens all in the onRender callback we register here to the view and implement later in this exmaple.</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;Let&#39;s skip the window opening - you should know that by now from the examples before - and go to the first call of the iTextureResourceFactory. This factory is where we get our texture from. To just load a texture we call loadFile like this.</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    // load the background tile texture</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    _backgroundTexture = iTextureResourceFactory::getInstance().loadFile(&quot;WidgetThemePattern.png&quot;);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;It will load the texture synchronously and return after doing so with a shared pointer. The path to the texture by the way is relative to a set of search paths we can define via the iResourceManager.</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;In the next lines we try to load a texture that does not exist to see what happens.</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    // let&#39;s see what happens if we want Igor to load a texture that does not exist</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    con_endl(&quot;!!! next statement will fail with an error message about a missing texture !!!&quot;);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    con_endl(&quot;&quot;);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    _dummyTexture = iTextureResourceFactory::getInstance().loadFile(&quot;doesnotexist.foobar&quot;);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    // by default Igor generates a dummy texture that will be returned instead</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    // it is a checker texture with some gradients in color and alpha channels</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;Igor will print an error message to the console and use a generated texture from memory instead. As you have noticed it&#39;s the checker texture on the left of the screen shot.</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;Next we gonna configure a particle system that also uses a texture. But this time we gonna load it asynchronously using requestFile. It will return immediately and all it does is basically putting that load request in to a queue that will be processed later in our example. </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    // set up particle system</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    // load a texture for our particle system</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    _particleTexture = iTextureResourceFactory::getInstance().requestFile(&quot;simpleParticle.png&quot;);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;Let&#39;s continue with the particle system. </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    // set the range of particle sizes at spawn</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    _particleSystem.setParticleSize(10.0f, 70.0f);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    // set how much the particles should grow each frame</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    _particleSystem.setParticleSizeDelta(0.5f, 3.0f);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    // set initial velocity vector of particles at spawn</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    _particleSystem.setInitialVelocity(iaVector2f(40, 0));</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    // make the animation endless. this causes the particles to be reused after their lifetime is over</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    _particleSystem.setLoopable(true);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    // sets particle life time in frames</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    _particleSystem.setParticleLifetime(80);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    // set the emission rate per frame</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    _particleSystem.setEmitRate(5);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    // set maximal particle count. since the particle system is in loop mode we need at least as </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    // much particles as the life time times the emission rate to have a constant stream of particles</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    _particleSystem.setMaxParticleCount(_particleSystem.getParticleLifetime() * _particleSystem.getEmitRate());</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    // set the spread factor to 5% of the distribution circle</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    // you can also interpret it as opening angle in percent</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    _particleSystem.setSpreadFactor(0.05f);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    // don&#39;t want air drag</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    _particleSystem.setAirDrag(0.0f);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    // apply external force. in this case something like gravity but positive because the y coordinate axis goes down the screen</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    _particleSystem.setExternalForce(iaVector2f(0, 0.2f));</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;For a nice look of the particles we set up a color gradient using the iRainbow class to define the actual rainbow colors.</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    // define a rainbow multi color gradient for our particles</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    _rainbow.insertColor(iaColor4f(1, 0, 1, 0.0), 0.0f);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    _rainbow.insertColor(iaColor4f(0, 0, 1, 0.2), 0.2f);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    _rainbow.insertColor(iaColor4f(0, 1, 1, 0.4), 0.4f);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    _rainbow.insertColor(iaColor4f(0, 1, 0, 0.6), 0.6f);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    _rainbow.insertColor(iaColor4f(1, 1, 0, 0.8), 0.8f);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    _rainbow.insertColor(iaColor4f(1, 0, 0, 1.0), 1.0f);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;So now the particle system is set up (we gonna have a look at how it&#39;s rendered later) there is two more ways of using a texture with Igor. One is in form of a texture based font and one is a sprite.</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    // load a texture font</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    _font = new iTextureFont(&quot;StandardFont.png&quot;);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    // load a texture as a sprite</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    // sprites are basically textures that have some additional meta data that help you to place and orientate them</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    _logo = new iSprite(iTextureResourceFactory::getInstance().loadFile(&quot;OpenGL-Logo.jpg&quot;));</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    // set the center as the origin of the sprite</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    _logo-&gt;setOrigin(iaVector2f(_logo-&gt;getTexture()-&gt;getWidth() * 0.5, _logo-&gt;getTexture()-&gt;getHeight() * 0.5));</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;The font implicitly loads a texture synchronously so it can analyse the texture for where the single letters are in order to later nicely print them on screen.</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;The Sprite is basically a texture plus some meta information including the origin (e.g. to rotate around) and with and height in screen space independent of the textures resolution.</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;An other feature I&#39;d like to introduce is the iaBSpline class. Well it defines a B-Spline that we can use to look up 3D values along the spline.</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    // initalize a spline loop</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    _spline.addSupportPoint(iaVector3f(100, 100, 0));</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    _spline.addSupportPoint(iaVector3f(150, 80, 0));</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    _spline.addSupportPoint(iaVector3f(900, 600, 0));</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    _spline.addSupportPoint(iaVector3f(700, 500, 0));</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    _spline.addSupportPoint(iaVector3f(100, 700, 0));</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    _spline.addSupportPoint(iaVector3f(900, 300, 0));</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    _spline.addSupportPoint(iaVector3f(50, 150, 0));</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    // close the loop by having the end point at the same position as the start point</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    _spline.addSupportPoint(iaVector3f(100, 100, 0));</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    // defines the resolution of the output line strip if we later call getSpline</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    _spline.setResolution(20);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;For rendering anything in Igor we need to set up a couple of materials. Basically a material is a set of OpenGL based render states and or some shaders. Right now most of Igor still uses old school fix function pipeline due to laziness of the programmer ;-) but given enough time this will change.</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    // create some materials</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    _materialWithTextureAndBlending = iMaterialResourceFactory::getInstance().createMaterial();</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    iMaterialResourceFactory::getInstance().getMaterial(_materialWithTextureAndBlending)-&gt;getRenderStateSet().setRenderState(iRenderState::Texture2D0, iRenderStateValue::On);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    iMaterialResourceFactory::getInstance().getMaterial(_materialWithTextureAndBlending)-&gt;getRenderStateSet().setRenderState(iRenderState::Blend, iRenderStateValue::On);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    iMaterialResourceFactory::getInstance().getMaterial(_materialWithTextureAndBlending)-&gt;getRenderStateSet().setRenderState(iRenderState::DepthTest, iRenderStateValue::Off);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    _materialWithTexture = iMaterialResourceFactory::getInstance().createMaterial();</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    iMaterialResourceFactory::getInstance().getMaterial(_materialWithTexture)-&gt;getRenderStateSet().setRenderState(iRenderState::Texture2D0, iRenderStateValue::On);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    iMaterialResourceFactory::getInstance().getMaterial(_materialWithTexture)-&gt;getRenderStateSet().setRenderState(iRenderState::DepthTest, iRenderStateValue::Off);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    _materialWithoutDepthTest = iMaterialResourceFactory::getInstance().createMaterial();</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    iMaterialResourceFactory::getInstance().getMaterial(_materialWithoutDepthTest)-&gt;getRenderStateSet().setRenderState(iRenderState::DepthTest, iRenderStateValue::Off);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;No it&#39;s time to load the requested textures by doing a flush in the iTextureResourceFactory. So technically this is not asynchronous loading of textures. And that is correct but this way you can choose whether to just make a flush between level loading or run it in a separate thread to continuously loading/unloading textures in the background. The last scenario is easiest by just creating iTaskFlushTextures and add it in to the iTaskManager.</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    // load requested textures</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    iTextureResourceFactory::getInstance().flush();</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;On the deinit end we destroy the created materials ...</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    // release materials (optional)</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    iMaterialResourceFactory::getInstance().destroyMaterial(_materialWithTextureAndBlending);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    _materialWithTextureAndBlending = 0;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    iMaterialResourceFactory::getInstance().destroyMaterial(_materialWithTexture);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    _materialWithTexture = 0;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    iMaterialResourceFactory::getInstance().destroyMaterial(_materialWithoutDepthTest);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    _materialWithoutDepthTest = 0;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;... and destroy the font and the sprite and release the textures.</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    // release some textures. otherwhise you will get a reminder of possible mem leak</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    if (_logo != nullptr)</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        delete _logo;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        _logo = nullptr;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    if (_font != nullptr)</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        delete _font;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        _font = nullptr;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    _particleTexture = nullptr;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    _backgroundTexture = nullptr;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    _dummyTexture = nullptr;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;Next interessting part in the example is the onHandle implementation which is called before every render frame. And inside of that the updateParticles method. Basically we manipulate the start velocity of the particles over time based on a 2D perlin noise function and than we call the particle systems handle which updates the particles position.</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    // manipulates particles initial velocity over time</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    iaVector2f velocity(12, 0);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    float32 emitangle = _perlinNoise.getValue(_particleAnimatioValue * 0.05, 3) + 0.1;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    velocity.rotateXY(emitangle);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    _particleSystem.setInitialVelocity(velocity);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    _particleAnimatioValue += 1.0f;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    // calls particles iteration</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    _particleSystem.handle();</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;And now we have a look at the rendering which happens in the onRender method. Since Igor is based on OpenGL we have to setup the OpenGL matrices first in order to see anything we are going to render.</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    // since the model matrix is by default an identity matrix which would cause all our 2d rendering end up at depth zero</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    // and the near clipping plane of our frustum can&#39;t be zero we have to push the scene a bit away from zero (e.g. -30 just a random number with no meaning)</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    iaMatrixf matrix;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    iRenderer::getInstance().setViewMatrix(matrix);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    matrix.translate(iaVector3f(0, 0, -30));</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    iRenderer::getInstance().setModelMatrix(matrix);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;Now that the matrices are set up we can besically just switch between materials and colors and directly use all the 2d rendering methods the iRenderer provides. So for rendering our tiled background texture we call ...</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    // set a textured material and draw the tiles texture as background</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    iMaterialResourceFactory::getInstance().setMaterial(_materialWithTexture);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    iRenderer::getInstance().setColor(iaColor4f(1, 1, 1, 1));</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    iRenderer::getInstance().drawTextureTiled(0, 0, _window.getClientWidth(), _window.getClientHeight(), _backgroundTexture);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;... and to draw some non textured primitives we call ...</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    // set non textured material and draw some primitves</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    iMaterialResourceFactory::getInstance().setMaterial(_materialWithoutDepthTest);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    iRenderer::getInstance().setColor(iaColor4f(0, 0, 0, 1));</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    iRenderer::getInstance().drawRectangle(10, 10, 200, 150);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    iRenderer::getInstance().drawRectangle(220, 10, 200, 150);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    iRenderer::getInstance().setColor(iaColor4f(1, 1, 0, 1));</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    iRenderer::getInstance().setLineWidth(3);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    iRenderer::getInstance().drawLine(20, 20, 200, 150);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    iRenderer::getInstance().drawLine(20, 150, 200, 20);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    iRenderer::getInstance().drawLine(110, 20, 110, 150);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    iRenderer::getInstance().drawLine(20, 85, 200, 85);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    for (int x = 0; x &lt; 19; ++x)</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        for (int y = 0; y &lt; 14; ++y)</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            iRenderer::getInstance().setPointSize(rand() % 5 + 1);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            iRenderer::getInstance().drawPoint(230 + x * 10, 20 + y * 10);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;... and this is how we draw a sprite ...</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    // change material again to textured an draw the logo</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    iMaterialResourceFactory::getInstance().setMaterial(_materialWithTextureAndBlending);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    iRenderer::getInstance().setColor(iaColor4f(1, 1, 1, 1));</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    iRenderer::getInstance().drawSprite(_logo, _logoPosition._x, _logoPosition._y, _logoRotationAngle, 1.5f, 1.5f);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;... and a regular texture ...</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    // draw the texture that we could not load at startup</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    iRenderer::getInstance().setColor(iaColor4f(1, 1, 1, 1));</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    iRenderer::getInstance().drawTexture(10, 170, 410, 150, _dummyTexture);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;... and the particle system (please notice the rainbow at the end)...</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    // draw the particles</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    iRenderer::getInstance().setColor(iaColor4f(0, 1, 0, 0.5));</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    iRenderer::getInstance().bindTexture(_particleTexture, 0);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    iRenderer::getInstance().drawParticles(-10, _window.getClientHeight() - 150, 0, _particleSystem.getParticles(), _particleSystem.getParticleCount(), &amp;_rainbow);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;.. draw some text from wikipedia about OpenGL ...</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    // draw some text from wikipedia</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    iaString wikipediaOpenGL = &quot;OpenGL (Open Graphics Library) ist eine Spezifikation fuer eine plattform- und programmiersprachenunabhaengige Programmierschnittstelle zur Entwicklung von 2D- und 3D-Computergrafik. Der OpenGL-Standard beschreibt etwa 250 Befehle, die die Darstellung komplexer 3D-Szenen in Echtzeit erlauben. Zudem koennen andere Organisationen (zumeist Hersteller von Grafikkarten) proprietaere Erweiterungen definieren. Wikipedia&quot;;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    iRenderer::getInstance().setFont(_font);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    iRenderer::getInstance().setFontSize(15.0f);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    iRenderer::getInstance().setColor(iaColor4f(0, 0, 0, 1));</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    iRenderer::getInstance().drawString(600, 100, wikipediaOpenGL, -30, 400);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;... and render the spline ...</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    // draw spline</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    iMaterialResourceFactory::getInstance().setMaterial(_materialWithoutDepthTest);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    iRenderer::getInstance().setColor(iaColor4f(1, 0, 0.5, 1));</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    iRenderer::getInstance().drawLineStrip(_spline.getSpline());</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;.. and some perlin nioise based 2D graph.</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    // draw random graph in the upper right corner</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    iRenderer::getInstance().setColor(iaColor4f(0, 0, 0, 1));</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    iRenderer::getInstance().drawRectangle(_window.getClientWidth() - 260, 10, 250, 150);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    static float32 offset = 0.0f;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    iRenderer::getInstance().setLineWidth(1);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    iRenderer::getInstance().setColor(iaColor4f(0, 1, 0, 1));</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    float64 lastValue = _perlinNoise.getValue(offset * 0.01, 6) * 150;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    for (int x = 1; x &lt; 250; ++x)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        float64 value = _perlinNoise.getValue((offset + x) * 0.01, 6) * 150;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        iRenderer::getInstance().drawLine(_window.getClientWidth() - 260 + x - 1, 10 + lastValue, _window.getClientWidth() - 260 + x, 10 + value);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        lastValue = value;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    offset += 1.0f;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;Last but not least there is a class alled iStatistics in Igor that can measure for you all about timings. We just use it here to draw the frame rate on the screen.</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    // draw frame rate in lower right corner</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    iStatistics::getInstance().drawStatistics(&amp;_window, _font, iaColor4f(0, 1, 0, 1));</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;And that&#39;s all to it. For further questions please contact [tanzfisch](https://github.com/tanzfisch).</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
		<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
			<ul>
				<li class="navelem"><a class="el" href="_example03__2_d___rendering_8md.html">Example03_2D_Rendering.md</a></li>
				<li class="footer">
					Generated on Sat May 25 2019 16:07:59 for Igor by <a href="http://www.doxygen.org/index.html">
					<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8.
					Dark theme by <a href="http://majerle.eu" target="_new">Tilen Majerle</a>. All rights reserved.
				</li>
			</ul>
		</div>
		<script src="custom.js"></script>
	</body>
</html>